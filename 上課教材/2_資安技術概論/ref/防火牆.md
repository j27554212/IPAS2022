# 何謂防火牆
```
選擇哪些封包可以將其轉送至另一介面
放行合法封包，封鎖不合法封包
如此達到保護防火牆後方主機的目的

ex:可指定主機A「不得」存取主機B上的任何服務或SSH Service
```
# 防火牆的判別依據
```
各層封包表頭內的資訊
封包所承載的資料內容
連線狀態
```
### 各層封包表頭內的資訊
```
連結層
利用MAC address
藉由Destination MAC來判別封包是由哪一部主機送出來的
```
```
網路層

IP表頭中可作為過濾的條件

Header Length : IP表頭的長度
Differentiated Service : 差別服務判別，執行QOS時即可能會使用到，一般正常值應為0(零）
Total Length : 封包不包含連結層表頭的整體長度
Flags : 註明封包是否被切割，或者指定封包可不可以被切割
Time to Live : 封包的存活時間
Protocol : 上層協定，如TCP為06、UDP為17、ICMP為01
其他的上層定請參考Linux 系統的／etc/protoco 檔案
Source : 來源端主機的 IP 位址
Destination : 目的端主機的 IP 位址
```
```
傳輸層

TCP表頭中可作為過濾的條件

Source Port : 來源端應用程式所在的port號
Destination Port : 目的端應用程式所在的port號
Header Length : TCP表頭的整體長度
Flags : TCP表頭內的連線控制旗標，TCP表頭中最為重要的資訊
```
### 封包所承載的資料內容
```
ex:
查看HTTP協定封包，Client端欲存取的對象www.kimo.com.tw
使用"Host:wwwkimo.com.tw"作為過濾條件
```
### 連線狀態
```
連線狀態判別
ex:
192.168.0.100:3365傳送封包給192.168.6.2:80
192.168.6.2:80會回應封包給192.168.0.100:3365
```
# 防火牆的分類
```
封包過濾防火牆
應用層防火牆
```
### 封包過濾防火牆
```
是以Routing的方式，將封包轉送至另一個介面
每次能夠執行檢査的最小單位為「一個封包」

優:
1.「記憶體」及「 CPU效能」都不需要很高
2.以Router 的型式存在網路上，應用的範圍較廣
缺:
無法對連線中的資訊，執行極為精準的過濾動作
ex:無法檢查一封電子郵件中是否帶有電腦病毒
```
### 應用層防火牆
```
Application filte process將會收下一條連線的所有封包

優:
能夠檢查到一條連線中的每一個Byte，進行精準的過濾動作
缺:
1.必須執行封包的儲存及還原動作，需要更多的記憶體及CPU的運算資源
2.Application filte process 不支援的通訊協定便無法處理，應用範圍較低
```
# 常見的防火牆結構
```
單機防火牆
閘道式防火牆
通透式防火牆
```
### 單機防火牆
```
保護範圍只有本機
單機防火牆通常是軟體，工作在網路卡的驅動程式位置
要進出本機的封包皆會受到防火牆的監控
```
### 閘道式防火牆
```
保護範圍是一整個網路

型式一
一對一NAT
防火牆對外的介面上，設定ISP所配發的IP
Server指定私有IP
使用者存取IP時，將封包轉送到私有IP
私有IP送出封包時，轉送回IP
```
```
型式二
在防火牆上再多加一片網路卡，多增加一個網路區段
此網路區段稱為「非軍事區」 (Demilitarized Zone : DMZ)

作法一:將提供對外服務的主機放至DMZ之中
作法二:將反向代理伺服器 (Reverse Proxy)放至DMZ之中
```
```
型式三
與型式二相同，只是使用兩部防火牆主機(不同公司的產品)
```
### 通透式防火牆
```
就是一個Bridge設備
並在Bridge設備上賦予Filter的能力
沒有「 Routing 」的問題，也沒有IP address
部署能力相當強，且隱密性相當高
```
